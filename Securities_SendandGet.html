<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Blockchain Seal Verification System</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/w3.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="js/sessionjs.js" type="text/javascript"></script>
        <script src="js/web3.js" type="text/javascript"></script>
        <script src="js/buffer.js" type="text/javascript"></script>
        <script src="js/ipfs.js" type="text/javascript"></script>
        <script src="js/abi-decoder.js" type="text/javascript"></script>
        <style>
            html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
        </style>
        <script>
            //連接區塊鏈
            var Web3 = require('web3');
            var web3 = new Web3();
            web3.setProvider(new web3.providers.HttpProvider("http://140.124.93.79:8545"));
            var isConnected = web3.isConnected();
            //console.log(isConnected);
            if (!isConnected) {
                alert("請先連接區塊鏈！！");
            }
            //連接區塊鏈

            //合約區
            //register_Account contractABI
            var register_Account_contractABI = [{"constant": false, "inputs": [{"name": "id", "type": "string"}, {"name": "reacc", "type": "address"}, {"name": "prikey", "type": "string"}, {"name": "pubkey", "type": "string"}, {"name": "pwd", "type": "string"}, {"name": "redt", "type": "string"}], "name": "registerAccount", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function"}];
            //register_Account contractABI

            //upload_file_address_contractABI
            //var upload_file_address_contractABI = [{"constant": false, "inputs": [{"name": "opname", "type": "string"}, {"name": "opformat", "type": "string"}, {"name": "ophash", "type": "string"}, {"name": "sealname", "type": "string"}, {"name": "sealformat", "type": "string"}, {"name": "sealhash", "type": "string"}, {"name": "datetime", "type": "string"}, {"name": "acc", "type": "address"}], "name": "setIpfs", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function"}];
            //upload_file_address_contractABI
            //合約區

            var mySidebar;
            var overlayBg;
            var useraccount;
            var decodedDataArray = [];
            window.onload = function () {
                mySidebar = document.getElementById("mySidebar");
                overlayBg = document.getElementById("myOverlay");
                var sessionObj = Session.get("name");
                if (sessionObj != null) {
                    document.getElementById("idshow").textContent = sessionObj.id;
                    document.getElementById("accshow").textContent = sessionObj.account;
                    useraccount = sessionObj.account;
                } else {
                    location.href = "index.html";
                }
                GetBankAccountList();
            };
            function w3_open() {
                if (mySidebar.style.display === 'block') {
                    mySidebar.style.display = 'none';
                    overlayBg.style.display = 'none';
                } else {
                    mySidebar.style.display = 'block';
                    overlayBg.style.display = 'block';
                }
            }
            function w3_close() {
                mySidebar.style.display = "none";
                overlayBg.style.display = "none";
            }
            function Logout() {
                Session.clear();
                location.href = "index.html";
            }
            function GetBankAccountList() {
                var getAccdeCodeData = GetTranscation(register_Account_contractABI);
                var select = document.getElementById("to_bank_select");
                for (var i = 0; i < getAccdeCodeData.length; i++) {
                    if (typeof getAccdeCodeData[i] !== "undefined") {
                        if (getAccdeCodeData[i].params[0].value == "Bank") {
                            var accountData = getAccdeCodeData[i].params[1].value;
                            var option = document.createElement("option");
                            option.setAttribute("value", accountData);
                            var optionText = document.createTextNode(accountData);
                            option.append(optionText);
                            select.append(option);
                        }
                    }
                }
            }
            function GetTransactionList() {
                var getTransactiondeCodeData = GetTranscation(upload_file_address_contractABI);
            }
            function GetTranscation(abi) {
                decodedDataArray.length = 0;
                var blockNumber = web3.eth.blockNumber;
                for (var i = 1; i <= blockNumber; i++) {
                    var blockinfo = web3.eth.getBlock(i);
                    var blockTransactionLength = blockinfo.transactions.length;
                    if (blockTransactionLength > 0) {
                        for (var j = 0; j < blockTransactionLength; j++) {
                            var transaction = web3.eth.getTransaction(blockinfo.transactions[j]);
                            abiDecoder.addABI(abi);
                            var transaction_input = transaction.input;
                            var decodedData = abiDecoder.decodeMethod(transaction_input);
                            decodedDataArray.push(decodedData);
                            //console.log(decodedData);
                        }
                    }
                }
                //console.log(decodedDataArray);
                return decodedDataArray;
            }
        </script>
    </head>
    <body class="w3-light-grey">
        <!-- Top container -->
        <div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
            <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>
            <button class="w3-bar-item w3-black w3-right" onclick="Logout()"><span class="w3-bar-item w3-right"><i class="fa fa-sign-out"></i></span></button>
        </div>

        <!-- Sidebar/menu -->
        <nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:400px;" id="mySidebar"><br>
            <div class="w3-container w3-center">
                <h5>ID</h5>
                <div class="w3-col l12 m12 s12" id="idshow"></div>
            </div>
            <br>
            <div class="w3-container w3-center">
                <h5>Account</h5>
                <div class="w3-col l12 m12 s12" id="accshow"></div>
            </div>
            <hr>
            <div class="w3-bar-block">
                <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
                <a href="Securities_index.html" class="w3-bar-item w3-button w3-padding"><i class="fa fa-upload fa-fw"></i>  Upload</a>
                <a href="Securities_SendandGet.html" class="w3-bar-item w3-button w3-padding"><i class="fa fa-paper-plane fa-fw"></i>  Send & Get</a>
                <a href="Securities_Views.html" class="w3-bar-item w3-button w3-padding"><i class="fa fa-eye fa-fw"></i>  Views</a>
            </div>
        </nav>

        <!-- Overlay effect when opening sidebar on small screens -->
        <div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

        <!-- !PAGE CONTENT! -->
        <div class="w3-main" style="margin-left:425px;margin-top:60px;">
            <div class="w3-container">
                <div class="w3-card-4 w3-margin">
                    <header class="w3-container w3-blue">
                        <h5><b><i class="fa fa-upload"></i>&nbsp;Send&nbsp;&&nbsp;Get</b></h5>
                    </header>

                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>To Bank：</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <select class="w3-col l12 m12 s12 w3-padding-small" id="to_bank_select"></select>
                        </div>
                    </div>
                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>Upload Address：</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <input class="w3-input w3-border" type="text" id="upload_address">
                        </div>
                    </div>
                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>上傳時間：</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <input class="w3-input w3-border" type="text" id="upload_datetime">
                        </div>
                    </div>
                    <div class="w3-col l12 m12 s12 w3-center w3-margin-bottom"><b>顯示上傳訊息</b></div>
                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>開戶文件</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <input class="w3-input w3-border" type="text" id="opfile_ipfs_hash">
                        </div>
                    </div>
                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>開戶文件<br>IPFS Hash：</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <input class="w3-input w3-border" type="text" id="opfile_ipfs_hash">
                        </div>
                    </div>
                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>印鑑圖檔</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <input class="w3-input w3-border" type="text" id="seal_image">
                        </div>
                    </div>
                    <div class="w3-container w3-margin">
                        <div class="w3-col l2 m2 s2">
                            <label><b>開戶文件<br>IPFS Hash：</b></label>
                        </div>
                        <div class="w3-col l10 m10 s10">
                            <input class="w3-input w3-border" type="text" id="seal_image">
                        </div>
                    </div>
                    <div class="w3-container w3-margin">
                        <button class="w3-btn w3-blue w3-block" onclick="">傳送</button>
                    </div>
                    <footer class="w3-container"></footer>
                </div>
            </div>
        </div>
    </body>
</html>
